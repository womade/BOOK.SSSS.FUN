var ua=navigator.userAgent,isiOS=!!ua.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),ipad=ua.match(/(iPad).*OS\s([\d_]+)/),isIphone=!ipad&&ua.match(/(iPhone\sOS)\s([\d_]+)/),isAndroid=ua.match(/(Android)\s+([\d.]+)/),isMobile=isIphone||isAndroid,m=window.location.pathname.split("/")[1],loading=!1,sharesite=$("meta[name\x3dsharesite]").attr("content"),thislang=parseInt($("body").attr("lang")),shelfhtml={box:function(b){var a="";$.each(b,function(b,c){var d=c.thumbnail.w,e=c.thumbnail.h;110<e&&(e=110,d=c.thumbnail.w/c.thumbnail.h*110);110<d&&(d=110,e=c.thumbnail.h/c.thumbnail.w*110);var h="";1==$("#map").attr("showname")&&isMobile&&(h='\x3cdiv class\x3d"showname"\x3e'+c.journal+"\x3c/div\x3e");a+='\x3cdiv class\x3d"box"\x3e';a+='\x3cdiv class\x3d"abox"\x3e';a+='\x3ca class\x3d"open" title\x3d"'+c.journal+'" data-info\x3d"'+jsontouri(c)+'" style\x3d"width:'+d+"px;height:"+e+'px"\x3e\x3cimg data-original\x3d"'+c.thumbnail.src+'"/\x3e\x3cdiv class\x3d"thickness"\x3e\x3cdiv\x3e\x3c/div\x3e\x3cdiv\x3e\x3c/div\x3e\x3cdiv\x3e\x3c/div\x3e\x3cdiv\x3e\x3c/div\x3e\x3cdiv\x3e\x3c/div\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e'+h;a+="\x3c/div\x3e\x3c/div\x3e"});return a},bookSort:function(b){var a="";$.each(b,function(b,c){a+='\x3cdiv class\x3d"box loading anm"\x3e';a+='\x3cdiv class\x3d"abox"\x3e';a+='\x3ca class\x3d"openSort" data-info\x3d"'+jsontouri(c)+'" style\x3d"width:128px;height:135px"\x3e\x3cimg src\x3d"'+funs.getSortSkin()+'"/\x3e\x3cdiv class\x3d"sortinfo"\x3e\x3cdiv class\x3d"sortname"\x3e'+c.name+'\x3c/div\x3e\x3cdiv class\x3d"sortnum"\x3e'+c.num+"\x3cem\x3e"+lang("Ben")+"\x3c/em\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e";a+="\x3c/div\x3e\x3c/div\x3e"});return a},booklist:function(b){var a="\x3cul\x3e";$.each(b,function(b,c){a+="\x3cli\x3e";a+='\x3ca class\x3d"open" data-info\x3d"'+jsontouri(c)+'"\x3e\x3cspan class\x3d"l"\x3e'+c.journal+'\x3c/span\x3e\x3cspan class\x3d"r"\x3e'+c.updated+"\x3c/span\x3e\x3c/a\x3e";a+="\x3c/li\x3e"});return a+="\x3c/ul\x3e"},webpage:function(b){return'\x3cdiv id\x3d"webpage"\x3e\x3ciframe class\x3d"flframe" src\x3d"'+b+'"\x3e\x3c/div\x3e'},selectBookSort:function(b){var a='\x3cdiv class\x3d"sortBox"\x3e\x3cdiv class\x3d"selectBookSort input-form"\x3e',a=a+'\x3cdiv class\x3d"select-arrow aclick" name\x3d"selectOptions"\x3e\x3cdiv class\x3d"arrow-up"\x3e\x3c/div\x3e\x3cdiv class\x3d"arrow-down"\x3e\x3c/div\x3e\x3c/div\x3e',a=a+('\x3cdiv class\x3d"select-value aclick" name\x3d"selectOptions" data-lang\x3d"ALLBOOKS"\x3e'+lang("ALLBOOKS")+"\x3c/div\x3e"),a=a+'\x3cdiv class\x3d"select-options hide"\x3e\x3cdiv class\x3d"options"\x3e',a=a+('\x3cdiv data-index\x3d"all" data-lang\x3d"ALLBOOKS"\x3e'+lang("ALLBOOKS")+"\x3c/div\x3e");$.each(b,function(b,c){a+='\x3cdiv data-index\x3d"'+b+'"\x3e'+c.name+"\x3c/div\x3e"});return a+="\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e"}},shelfuns={size:function(){var b=$(window).width(),a=$(window).height()-60-42,d=Math.floor(b/152);$("#map").width(152*d);$("#map").height()<a?b=152*Math.ceil(a/152):(a=$("#map\x3e.box").length,d=Math.floor(b/152),b=152*Math.ceil(a/d));1==$OP.booktype?$(".booksbox").css("height","100%"):$(".booksbox").height(b)},scroll:function(){if(isMobile)$("#gdbox").css("overflow-y","auto");else(new IScroll("#gdbox",{mouseWheel:!0,bounce:!1})).on("scrollEnd",function(){lazyImg.updata()})},tippy:function(){tippy("[title]",{delay:100,distance:5,size:"small"})},skin:function(){var b=$("#main").attr("name");"skin-1"==b?$("#main").attr("name","skin-2"):"skin-2"==b?$("#main").attr("name","skin-3"):$("#main").attr("name","skin-1");1==$OP.booktype&&$(".openSort img").attr("src",funs.getSortSkin())},more:function(){$("#main").hasClass("right")?$("#main").removeClass("right"):$("#main").addClass("right")}};function post(b,a,d,c){"undefined"==typeof d&&(d=!0);c&&c.addClass("data-loading");$.ajax({type:"POST",url:"https://api.ssss.fun/sbook/",data:b,dataType:"json",async:d,success:function(b){1==b.code&&(c&&c.removeClass("data-loading"),a(b))},error:function(a,b,d){c&&c.removeClass("data-loading")}})}function banwxdropdown(){if(isMobile){$(".top,.bottom").on("touchmove",function(a){a.preventDefault()},!1);var b;$("#gdbox").on("touchstart",function(a){b=a.originalEvent.changedTouches[0].clientY});$("#gdbox").on("touchmove",function(a){var d=a.originalEvent.changedTouches[0].clientY,c=$(this).scrollTop();d>=b&&10>=c&&(b=d,a.preventDefault());b=d})}}function gettouch(){var b,a,d=document.getElementById("gdbox");d.addEventListener("touchstart",function(a){a=a.changedTouches;b=a[0].clientX;starty=a[0].clientY});d.addEventListener("touchend",function(c){c=c.changedTouches;a=c[0].clientX;endy=c[0].clientY;Math.abs(b-a)>Math.abs(starty-endy)&&(30<b-a?$("#main").removeClass("right"):30<a-b&&$("#main").addClass("right"))})}function return_prepage(){}var funs={showBookSort:function(b){$("#map").html(shelfhtml.bookSort(b));$(".loading").each(function(a){var b=this;setTimeout(function(){$(b).removeClass("loading")},50*a)});$("#allnums").text(b.length);$("#main").addClass("bookSort");$(".unit").text(lang("Tao"))},showBooks:function(b){$("#map").html(shelfhtml.box(b));lazyImg["int"]($("#gdbox"));isMobile||shelfuns.tippy();$("#allnums").text(b.length);$("#main").removeClass("bookSort");$(".unit").text(lang("Ben"));2==$OP.booktype&&0==$(".sortBox").length&&$(".booksbox").append(shelfhtml.selectBookSort(bookSort))},getSortSkin:function(){return"https://book.ssss.fun/bookshelf/img/"+$("#main").attr("name")+"/folder.png"}},books=[],bookSort=[];$(function(){bookspopfun.lang(thislang);$(document).bind("contextmenu",function(b){if("true"!==$(b.target).attr("contextmenu")&&"canvas"!==b.target.localName)return!1});$(window).resize(function(){shelfuns.size()});post({ascription:$OP.id},function(b){1==b.code&&(0<$OP.booktype?(bookSort=b.data.sort,bookSort.some(function(a,b){a.books.some(function(a,b){books.push(a)})}),1==$OP.booktype?funs.showBookSort(b.data.sort):funs.showBooks(books)):(books=b.data.books,funs.showBooks(books)),$("#booklist").html(shelfhtml.booklist(books)),shelfuns.size(),shelfuns.scroll())});banwxdropdown();$("body").on(click,".abtn,.aclick",function(b){var a=$(this),d=a.attr("name");switch(d){case "skin":case "more":shelfuns[d]();break;case "date":var c=1==$OP.booktype&&$(".abtn[name\x3d'backSort']").hasClass("hide")?".openSort":".open";"ab"==a.data("sort")?(a.data("sort","ba"),b=$("#map\x3e.box").sort(function(a,b){return uritojson($(a).find(c).data("info")).id-uritojson($(b).find(c).data("info")).id})):(a.data("sort","ab"),b=$("#map\x3e.box").sort(function(a,b){return uritojson($(b).find(c).data("info")).id-uritojson($(a).find(c).data("info")).id}));$("#map").html(b);break;case "name":$.getScript("/static/out/bookshelf/js/ChineseSort.js",function(){var b=function(b){if(1==$OP.booktype&&$(".abtn[name\x3d'backSort']").hasClass("hide"))var a=".openSort",c="name";else a=".open",c="journal";return uritojson($(b).find(a).data("info"))[c]},c=function(a,c){for(var d=0,f=checkCh(b(a),d),g=checkCh(b(c),d),e=b(a).length>b(c).length?b(c).length:b(a).length;f==g&&d<=e;)d++,f=checkCh(b(a),d),g=checkCh(b(c),d);return{a:f,b:g}};if("ab"==a.data("sort")){a.data("sort","ba");var d=$("#map\x3e.box").sort(function(a,b){return(c(a,b).b+"").localeCompare(c(a,b).a+"")})}else a.data("sort","ab"),d=$("#map\x3e.box").sort(function(a,b){return(c(a,b).a+"").localeCompare(c(a,b).b+"")});$("#map").html(d)});break;case "backSort":$(".abtn[name\x3d'backSort']").addClass("hide").siblings(".abtn[name\x3d'more']").removeClass("hide");funs.showBookSort(bookSort);break;case "selectOptions":b.stopPropagation();$(".select-options").hasClass("hide")?$(".select-options").removeClass("hide"):$(".select-options").addClass("hide");break;default:return!1}});$("body").on(click,".openSort",function(){var b=$(this).parents(".box").index();$(".abtn[name\x3d'more']").addClass("hide").siblings(".abtn[name\x3d'backSort']").removeClass("hide");funs.showBooks(bookSort[b].books)});$("body").on(click,".select-options\x3e.options\x3ediv",function(){var b=$(this).data("index");$(".selectBookSort\x3e.select-value").text($(this).text());var a=books;"all"!==b&&(a=bookSort[b].books);funs.showBooks(a)});$(document).on(click,"body",function(){$(".select-options").hasClass("hide")||$(".select-options").addClass("hide")});gettouch();$("body").on(click,"#leftbox .box\x3ea",function(b){$(this).next(".children").hasClass("hide")?($(this).parent().css("height","100%").siblings().addClass("hide"),$(this).children(".r").removeClass("icon-xiangyou").addClass("icon-xiangxia"),$(this).next(".children").removeClass("hide"),"search"==$(this).attr("name")&&$("#searchgo").focus(),"booklist"==$(this).attr("name")&&(isMobile?$("#booklist").css("overflow-y","auto"):new IScroll("#booklist",{mouseWheel:!0}))):($(this).parent().css("height","auto").siblings().removeClass("hide"),$(this).children(".r").removeClass("icon-xiangxia").addClass("icon-xiangyou"),$(this).next(".children").addClass("hide"),"search"==$(this).attr("name")&&$("#searchgo").blur())});$("#searchgo").bind("input propertychange",function(){var b=$(this).val();if(""==b)$("#searchlist").html("");else{var a="",a=a+"\x3cul\x3e";$("#booklist\x3eul\x3eli").each(function(){var d=$(this).children("a").data("info"),c=uritojson(d);-1<c.journal.indexOf(b)&&(a+='\x3cli\x3e\x3ca class\x3d"open" data-info\x3d"'+d+'"\x3e\x3cspan class\x3d"l"\x3e'+c.journal+'\x3c/span\x3e\x3cspan class\x3d"r"\x3e'+c.updated+"\x3c/span\x3e\x3c/a\x3e\x3c/li\x3e")});a+="\x3c/ul\x3e";$("#searchlist").html(a)}});$("body").on(click,"#language li",function(){language=$(this).index();$(this).children("i").addClass("icon-xuanzhong").removeClass("icon-weixuanzhong");$(this).siblings().children("i").addClass("icon-weixuanzhong").removeClass("icon-xuanzhong");bookspopfun.lang(language);setTimeout(function(){shelfuns.more()},200)})});
